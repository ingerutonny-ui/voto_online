<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>REPORTE DE TENDENCIAS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { background: #fff; color: #1a1a1a; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 40px; }
        h1 { margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .section { margin-bottom: 60px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f4f4f4; padding: 12px; border: 1px solid #ddd; text-align: left; }
        td { padding: 10px; border: 1px solid #ddd; }
        tr:nth-child(even) { background: #fafafa; }
        .page-break { page-break-before: always; }
        .btn-pdf { position: fixed; bottom: 20px; right: 20px; background: #000; color: #fff; padding: 15px 30px; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
<div id="reporte-pdf" class="container">
    <div class="header">
        <h1>PROYECTO EN LA NUBE</h1>
        <p>REPORTE OFICIAL DE TENDENCIAS ELECTORALES</p>
    </div>

    <div class="section">
        <h2>CIUDAD: ORURO</h2>
        <canvas id="chartOruro" width="400" height="150"></canvas>
        <table>
            <thead><tr><th>SIGLA</th><th>CANDIDATO</th><th>VOTOS</th></tr></thead>
            <tbody>
                {% for r in res_oruro %}
                <tr><td><strong>{{ r.nombre }}</strong></td><td>{{ r.alcalde }}</td><td>{{ r.total }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="page-break"></div>

    <div class="section">
        <h2>CIUDAD: LA PAZ</h2>
        <canvas id="chartLaPaz" width="400" height="150"></canvas>
        <table>
            <thead><tr><th>SIGLA</th><th>CANDIDATO</th><th>VOTOS</th></tr></thead>
            <tbody>
                {% for r in res_lapaz %}
                <tr><td><strong>{{ r.nombre }}</strong></td><td>{{ r.alcalde }}</td><td>{{ r.total }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<button class="btn-pdf" onclick="descargar()">DESCARGAR REPORTE PDF</button>
<script>
    function crearG(id, labels, data) {
        new Chart(document.getElementById(id), {
            type: 'bar',
            data: { labels: labels, datasets: [{ label: 'Votos', data: data, backgroundColor: '#333' }] }
        });
    }
    crearG('chartOruro', [{% for r in res_oruro %}"{{ r.nombre }}",{% endfor %}], [{% for r in res_oruro %}{{ r.total }},{% endfor %}]);
    crearG('chartLaPaz', [{% for r in res_lapaz %}"{{ r.nombre }}",{% endfor %}], [{% for r in res_lapaz %}{{ r.total }},{% endfor %}]);
    function descargar() {
        const element = document.getElementById('reporte-pdf');
        html2pdf().set({ margin: 0.5, filename: 'Reporte_Final.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' } }).from(element).save();
    }
</script>
</body>
</html>
