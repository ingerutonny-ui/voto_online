<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>MONITOREO DE TENDENCIAS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --accent: #d90429; }
        body { background: #000; color: white; font-family: sans-serif; padding: 20px; }
        .reporte-wrap { max-width: 900px; margin: auto; background: white; color: black; padding: 40px; border-radius: 10px; }
        .header { text-align: center; border-bottom: 2px solid var(--accent); margin-bottom: 30px; padding-bottom: 10px; }
        h2 { color: var(--accent); text-transform: uppercase; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th { background: #f2f2f2; padding: 10px; border: 1px solid #ddd; text-align: left; }
        td { padding: 8px; border: 1px solid #ddd; }
        
        /* Estilo Cebra */
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        .page-break { page-break-before: always; margin-top: 50px; }
        .btn-float { position: fixed; bottom: 20px; right: 20px; background: #27ae60; color: white; padding: 15px; border-radius: 50px; text-decoration: none; font-weight: bold; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div id="capture">
    <div class="reporte-wrap">
        <div class="header">
            <h1>REPORTE ELECTORAL - ORURO</h1>
            <p>Proyecto: HISTORIAL_CLINICO_NUBE</p>
        </div>
        <canvas id="chartOruro" width="400" height="150"></canvas>
        <table>
            <thead><tr><th>Sigla</th><th>Candidato</th><th>Votos</th></tr></thead>
            <tbody>
                {% for r in res_oruro %}
                <tr><td>{{ r.nombre }}</td><td>{{ r.alcalde }}</td><td><strong>{{ r.total }}</strong></td></tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="page-break"></div>

        <div class="header">
            <h1>REPORTE ELECTORAL - LA PAZ</h1>
        </div>
        <canvas id="chartLaPaz" width="400" height="150"></canvas>
        <table>
            <thead><tr><th>Sigla</th><th>Candidato</th><th>Votos</th></tr></thead>
            <tbody>
                {% for r in res_lapaz %}
                <tr><td>{{ r.nombre }}</td><td>{{ r.alcalde }}</td><td><strong>{{ r.total }}</strong></td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<button class="btn-float" onclick="descargar()">DESCARGAR REPORTE PDF</button>

<script>
    function crearGrafico(id, labels, data) {
        new Chart(document.getElementById(id), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{ label: 'Votos', data: data, backgroundColor: '#d90429' }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });
    }

    crearGrafico('chartOruro', [{% for r in res_oruro %}"{{ r.nombre }}",{% endfor %}], [{% for r in res_oruro %}{{ r.total }},{% endfor %}]);
    crearGrafico('chartLaPaz', [{% for r in res_lapaz %}"{{ r.nombre }}",{% endfor %}], [{% for r in res_lapaz %}{{ r.total }},{% endfor %}]);

    function descargar() {
        const element = document.getElementById('capture');
        html2pdf().set({
            margin: 0.5,
            filename: 'Reporte_Tendencias_2026.pdf',
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        }).from(element).save();
    }
</script>
</body>
</html>
