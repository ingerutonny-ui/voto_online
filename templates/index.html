<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONSULTA CIUDADANA</title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; font-family: sans-serif; background: #fff; }
        #sello-digital { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:none; flex-direction:column; align-items:center; justify-content:center; z-index:9999; text-align:center; }
        #splash { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:8888; }
        #main-content { display:none; flex-direction:column; align-items:center; padding:20px; text-align:center; }
        .loader { width:200px; height:10px; background:#eee; border-radius:10px; overflow:hidden; margin:20px 0; }
        .bar { width:0%; height:100%; background:#000; }
        .btn-city { display:flex; flex-direction:column; align-items:center; text-decoration:none; color:#000; font-weight:bold; border:1px solid #eee; padding:20px; border-radius:20px; width:220px; margin:10px; }
        .btn-city img { width:100px; height:100px; margin-bottom:10px; }
        .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); display:flex; align-items:center; justify-content:center; z-index:99999; }
    </style>
</head>
<body>

    <div id="sello-digital">
        <h1 style="color:red; font-size:4rem;">⚠️</h1>
        <h2>ACCESO LIMITADO</h2>
        <p>Dispositivo ya registrado en el sistema.</p>
    </div>

    <div id="splash">
        <div style="display:flex; gap:10px;"><img src="/static/accion2.png" width="100"><img src="/static/accion.png" width="100"></div>
        <div class="loader"><div class="bar" id="bar"></div></div>
        <h3 id="pct">0%</h3>
    </div>

    <div id="main-content">
        <h1>CONSULTA CIUDADANA</h1>
        <div style="display:flex; flex-wrap:wrap; justify-content:center;">
            <a href="/votar/ORURO" class="btn-city"><img src="/static/oruro.png">VOTAR EN: ORURO</a>
            <a href="/votar/LA PAZ" class="btn-city"><img src="/static/lapaz.png">VOTAR EN: LA PAZ</a>
        </div>
        <a href="/reporte" style="margin-top:30px; display:inline-block; padding:15px 30px; background:#000; color:#fff; border-radius:50px; text-decoration:none;">RESULTADOS</a>
    </div>

    {% if msg_type != '' %}
    <div class="overlay">
        <div style="text-align:center; padding:30px; border:1px solid #eee; border-radius:30px; background:#fff;">
            <h2 style="color:{{ 'blue' if msg_type == 'success' else 'red' }};">{{ 'REGISTRADO' if msg_type == 'success' else 'ERROR' }}</h2>
            <h1 style="font-size:3rem;">{{ ci_votante }}</h1>
            <a href="/" onclick="setVoto('{{ msg_type }}')" style="display:block; background:#000; color:#fff; padding:15px; border-radius:10px; text-decoration:none;">CONTINUAR</a>
        </div>
    </div>
    {% endif %}

    <script>
        function setVoto(t) { if(t === 'success') localStorage.setItem('voto_ok', '1'); }
        
        window.onload = () => {
            if ("{{ reset }}" === "true") { localStorage.removeItem('voto_ok'); window.location.href="/"; return; }
            
            if (localStorage.getItem('voto_ok') === '1' && "{{ msg_type }}" === "") {
                document.getElementById('splash').style.display = 'none';
                document.getElementById('sello-digital').style.display = 'flex';
                return;
            }

            let p = 0;
            let inv = setInterval(() => {
                p += 5;
                document.getElementById('bar').style.width = p + '%';
                document.getElementById('pct').innerText = p + '%';
                if(p >= 100) {
                    clearInterval(inv);
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main-content').style.display = 'flex';
                }
            }, 50);
        };
    </script>
</body>
</html>
